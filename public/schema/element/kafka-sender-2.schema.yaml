$id: http://qubership.org/schemas/product/qip/element/kafka-sender-2.schema.yaml
$schema: http://json-schema.org/draft-07/schema
type: object
allOf:
  - type: object
    allOf:
      - type: object
        title: Common Entity Properties
        properties:
          id:
            type: string
            title: Identifier
          name:
            type: string
            title: Name
        required:
          - id
          - name
      - type: object
        title: Entity with description
        properties:
          description:
            type: string
            title: Description
      - type: object
        properties:
          swimlaneId:
            type: string
title: Kafka Sender
description: Produce message in kafka
properties:
  type:
    type: string
    const: kafka-sender-2
  properties:
    type: object
    allOf:
      - $schema: http://json-schema.org/draft-07/schema
        type: object
        title: Kafka connection parameters
        properties:
          connectionSourceType:
            title: Connection source type
            enum:
              - maas
              - manual
          sslProtocol:
            enum:
              - TLS
              - TLSv1.1
              - TLSv1.2
              - TLSv1.3
            default: TLS
            title: SSL Protocol
            description: >
              The SSL protocol used to generate the SSLContext. Default setting
              is TLS, which is fine for most cases.
          sslEndpointAlgorithm:
            type: string
            title: SSL endpoint algorithm
            description: >
              The endpoint identification algorithm to validate server hostname
              using server certificate.
        if:
          properties:
            connectionSourceType:
              const: maas
        then:
          properties:
            topicsClassifierName:
              type: string
              title: Topic Classifier Name
            maasClassifierNamespace:
              type: string
              title: Topic Classifier Namespace
              description: >
                MaaS topic classifier namespace. By default used current
                namespace.
            maasClassifierTenantEnabled:
              type: boolean
              title: Tenant topic enabled
              description: Override default tenant id if classifier tenant enabled.
              default: false
          if:
            properties:
              maasClassifierTenantEnabled:
                const: true
            required:
              - maasClassifierTenantEnabled
          then:
            properties:
              maasClassifierTenantId:
                type: string
                title: Classifier Tenant ID
                description: Override default tenant id if classifier tenant enabled.
          required:
            - topicsClassifierName
        else:
          properties:
            brokers:
              type: string
              title: Brokers
            topics:
              type: string
              title: Topics
              description: |
                Topics name. Must be present in kafka, auto-creation disabled.
            securityProtocol:
              enum:
                - PLAINTEXT
                - SASL_PLAINTEXT
                - SASL_SSL
                - SSL
              default: PLAINTEXT
              title: Security Protocol
              description: Protocol used to communicate with brokers.
            saslMechanism:
              enum:
                - 9798-M-DSA-SHA1
                - 9798-M-ECDSA-SHA1
                - 9798-M-RSA-SHA1-ENC
                - 9798-U-DSA-SHA1
                - 9798-U-ECDSA-SHA1
                - 9798-U-RSA-SHA1-ENC
                - ANONYMOUS
                - CRAM-MD5
                - DIGEST-MD5
                - EAP-AES128
                - EAP-AES128-PLUS
                - ECDH-X25519-CHALLENGE[1]
                - ECDSA-NIST256P-CHALLENGE[1]
                - EXTERNAL
                - GS2-KRB5
                - GS2-KRB5-PLUS
                - GSS-SPNEGO
                - GSSAPI
                - KERBEROS_V4
                - KERBEROS_V5
                - LOGIN
                - NMAS_AUTHEN
                - NMAS_LOGIN
                - NMAS-SAMBA-AUTH
                - NTLM
                - OAUTH10A
                - OAUTHBEARER
                - OPENID20
                - OTP
                - PLAIN
                - SAML20
                - SCRAM-SHA-1
                - SCRAM-SHA-1-PLUS
                - SCRAM-SHA-256
                - SCRAM-SHA-256-PLUS
                - SCRAM-SHA-512
                - SECURID
                - SKEY
                - SPNEGO
                - SPNEGO-PLUS
                - XOAUTH
                - XOAUTH2
              default: GSSAPI
              title: SASL Mechanism
              description: >
                The Simple Authentication and Security Layer (SASL) Mechanism
                used.
            saslJaasConfig:
              type: string
              title: SASL JAAS Config
              description: >
                Expose the kafka sasl.jaas.config parameter Example:
                org.apache.kafka.common.security.plain.PlainLoginModule required
                username=example password=example;
          required:
            - brokers
            - securityProtocol
            - saslMechanism
            - topics
        required:
          - connectionSourceType
          - sslProtocol
      - $schema: http://json-schema.org/draft-07/schema
        type: object
        title: Context propagation properties
        properties:
          propagateContext:
            type: boolean
            title: Propagate context
            description: Propagate context to headers before sending message.
            default: true
          overrideContextParams:
            title: Override technical context headers
            description: Propagate props to headers before sending message.
            $schema: http://json-schema.org/draft-07/schema
            type: object
            patternProperties:
              ^.+$:
                type: string
    properties:
      key:
        type: string
        title: Key
        description: Record key
      keySerializer:
        anyOf:
          - type: string
          - enum:
              - org.apache.kafka.common.serialization.ByteArraySerializer
              - org.apache.kafka.common.serialization.ByteBufferSerializer
              - org.apache.kafka.common.serialization.BytesSerializer
              - org.apache.kafka.common.serialization.DoubleSerializer
              - org.apache.kafka.common.serialization.FloatSerializer
              - org.apache.kafka.common.serialization.IntegerSerializer
              - org.apache.kafka.common.serialization.LongSerializer
              - org.apache.kafka.common.serialization.ShortSerializer
              - org.apache.kafka.common.serialization.StringSerializer
              - org.apache.kafka.common.serialization.UUIDSerializer
              - org.apache.kafka.common.serialization.VoidSerializer
        default: org.apache.kafka.common.serialization.StringSerializer
        title: Key Serializer
        description: >
          The serializer class for keys (defaults to the same as for messages if
          nothing is given).
      valueSerializer:
        anyOf:
          - type: string
          - enum:
              - org.apache.kafka.common.serialization.ByteArraySerializer
              - org.apache.kafka.common.serialization.ByteBufferSerializer
              - org.apache.kafka.common.serialization.BytesSerializer
              - org.apache.kafka.common.serialization.DoubleSerializer
              - org.apache.kafka.common.serialization.FloatSerializer
              - org.apache.kafka.common.serialization.IntegerSerializer
              - org.apache.kafka.common.serialization.LongSerializer
              - org.apache.kafka.common.serialization.ShortSerializer
              - org.apache.kafka.common.serialization.StringSerializer
              - org.apache.kafka.common.serialization.UUIDSerializer
              - org.apache.kafka.common.serialization.VoidSerializer
        default: org.apache.kafka.common.serialization.StringSerializer
        title: Message serializer class
        description: The serializer class for messages
    required:
      - keySerializer
      - valueSerializer
required:
  - type
