/* ReactFlow Theme Integration */

/* Layout container styles for proper React Flow display */
.ant-layout-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.ant-row.stretched {
  flex: 1;
  min-height: 0;
}

.ant-col.stretched {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.graph-wrapper {
  flex: 1;
  min-height: 600px;
  display: flex;
}

/* Container styling - flat design */
.react-flow-container {
  height: 100%;
  min-height: 400px;
  flex-grow: 1;
  display: flex;
  border-radius: 4px;
  border: 1px solid var(--vscode-border);
  background-color: var(--vscode-panel-background);
  position: relative;
}

.react-flow {
  width: 100%;
  height: 100%;
  min-height: 600px;
}

.chain-layout {
  all: unset;
  display: flex;
  height: 100vh;
  border-radius: 4px;
  border: 1px solid var(--vscode-border);
  background-color: var(--vscode-panel-background);
}

/* ReactFlow viewport styling - transparent to show background */
.react-flow__viewport {
  background-color: transparent;
}

/* Node styling with theme support - flat design */
.react-flow__node {
  background-color: var(--vscode-panel-background);
  border: 1px solid var(--vscode-foreground);
  color: var(--vscode-foreground);
  font-family: var(--vscode-font-family);
  border-radius: 4px;
  box-shadow: none;
}

/* Container nodes - use editor background instead of panel background */

/* Override any inline styles that React Flow might apply */
.react-flow__node.container-node,
.react-flow__node.container-node[style*="background"],
.react-flow__node.container-node[style*="backgroundColor"] {
  background-color: var(--vscode-editor-background, #fff) !important;
  border: 1px solid var(--container-border-color, #dedacd) !important;
}

.vscode-webview .react-flow__node.container-node,
.vscode-webview .react-flow__node.container-node[style*="background"],
.vscode-webview .react-flow__node.container-node[style*="backgroundColor"] {
  background-color: var(--vscode-editor-background, #fff) !important;
  border: 1px solid var(--container-border-color, #dedacd) !important;
}

/* Container node text - dark theme - same color as regular nodes */
[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"]),
[data-theme="dark"] .react-flow__node-container[data-type="container"],
[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"])
  *:not(.react-flow__handle),
[data-theme="dark"]
  .react-flow__node-container[data-type="container"]
  *:not(.react-flow__handle),
[data-theme="dark"] .react-flow__node[data-node-type="container"],
[data-theme="dark"] .react-flow__node[data-type="container"],
[data-theme="dark"]
  .react-flow__node[data-node-type="container"]
  *:not(.react-flow__handle),
[data-theme="dark"]
  .react-flow__node[data-type="container"]
  *:not(.react-flow__handle),
[data-theme="dark"] .react-flow__node.container-node,
[data-theme="dark"] .react-flow__node.container-node *:not(.react-flow__handle),
.vscode-webview[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"]),
.vscode-webview[data-theme="dark"]
  .react-flow__node-container[data-type="container"],
.vscode-webview[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"])
  *:not(.react-flow__handle),
.vscode-webview[data-theme="dark"]
  .react-flow__node-container[data-type="container"]
  *:not(.react-flow__handle),
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-node-type="container"],
.vscode-webview[data-theme="dark"] .react-flow__node[data-type="container"],
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-node-type="container"]
  *:not(.react-flow__handle),
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-type="container"]
  *:not(.react-flow__handle),
.vscode-webview[data-theme="dark"] .react-flow__node.container-node,
.vscode-webview[data-theme="dark"]
  .react-flow__node.container-node
  *:not(.react-flow__handle) {
  color: rgb(0 0 0 / 88%) !important;
}

/* Container node text - high contrast theme - same color as regular nodes */
[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"]),
[data-theme="high-contrast"] .react-flow__node-container[data-type="container"],
[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"])
  *:not(.react-flow__handle),
[data-theme="high-contrast"]
  .react-flow__node-container[data-type="container"]
  *:not(.react-flow__handle),
[data-theme="high-contrast"] .react-flow__node[data-node-type="container"],
[data-theme="high-contrast"] .react-flow__node[data-type="container"],
[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"]
  *:not(.react-flow__handle),
[data-theme="high-contrast"]
  .react-flow__node[data-type="container"]
  *:not(.react-flow__handle),
[data-theme="high-contrast"] .react-flow__node.container-node,
[data-theme="high-contrast"]
  .react-flow__node.container-node
  *:not(.react-flow__handle),
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"]),
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container[data-type="container"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"])
  *:not(.react-flow__handle),
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container[data-type="container"]
  *:not(.react-flow__handle),
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-type="container"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"]
  *:not(.react-flow__handle),
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-type="container"]
  *:not(.react-flow__handle),
.vscode-webview[data-theme="high-contrast"] .react-flow__node.container-node,
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node.container-node
  *:not(.react-flow__handle) {
  color: rgb(0 0 0 / 88%) !important;
}

/* High contrast theme for container nodes */
[data-theme="high-contrast"] .react-flow__node.container-node,
[data-theme="high-contrast"]
  .react-flow__node.container-node[style*="background"],
[data-theme="high-contrast"]
  .react-flow__node.container-node[style*="backgroundColor"],
.vscode-webview[data-theme="high-contrast"] .react-flow__node.container-node,
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node.container-node[style*="background"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node.container-node[style*="backgroundColor"] {
  background-color: var(--vscode-editor-background, #000) !important;
  border-color: var(--container-border-color, #fff9e6) !important;
}

/* Node highlighting for selection and hover - flat design */
[class~="react-flow__node"]:not(.highlight) > div {
  background: unset;
  border: 1.5px solid transparent;
  box-shadow: none;
}

[class~="react-flow__node"].highlight > div {
  border-color: var(--vscode-focusBorder) !important;
  background: unset !important;
  box-shadow: none !important;
}

[class~="react-flow__node"].highlight > div > div:first-child {
  background: unset !important;
  border-bottom: unset !important;
}

/* Smooth transitions for theme changes */
.react-flow__node,
.react-flow__node[data-node-type="container"],
.react-flow__edge,
.react-flow__handle,
.react-flow__controls,
.react-flow__minimap,
.react-flow__panel,
.dndnode,
.trigger-node {
  transition:
    background-color var(--transition-duration) ease,
    border-color var(--transition-duration) ease,
    color var(--transition-duration) ease,
    box-shadow var(--transition-duration) ease;
}

/* Disable transitions during theme switching */
.theme-switching .react-flow__node,
.theme-switching .react-flow__node[data-node-type="container"],
.theme-switching .react-flow__edge,
.theme-switching .react-flow__handle,
.theme-switching .react-flow__controls,
.theme-switching .react-flow__minimap,
.theme-switching .react-flow__panel,
.theme-switching .dndnode,
.theme-switching .trigger-node {
  transition: none !important;
}

/* Dark theme for container nodes */
[data-theme="dark"] .react-flow__node.container-node,
[data-theme="dark"] .react-flow__node.container-node[style*="background"],
[data-theme="dark"] .react-flow__node.container-node[style*="backgroundColor"],
.vscode-webview[data-theme="dark"] .react-flow__node.container-node,
.vscode-webview[data-theme="dark"]
  .react-flow__node.container-node[style*="background"],
.vscode-webview[data-theme="dark"]
  .react-flow__node.container-node[style*="backgroundColor"] {
  background-color: var(--vscode-editor-background, #1f1f1f) !important;
  border-color: var(--container-border-color, #fff9e6) !important;
}

.react-flow__node.selected {
  border-color: var(--vscode-focusBorder);
  box-shadow: none;
}

/* Node text styling - adapt to theme */
.react-flow__node,
.react-flow__node *:not(.react-flow__handle) {
  color: rgb(0 0 0 / 88%) !important;
}

/* Container node text - same color as regular nodes */
.react-flow__node-container:has([data-node-type="container"]),
.react-flow__node-container[data-type="container"],
.react-flow__node-container:has([data-node-type="container"])
  *:not(.react-flow__handle),
.react-flow__node-container[data-type="container"] *:not(.react-flow__handle),
.react-flow__node[data-node-type="container"],
.react-flow__node[data-type="container"],
.react-flow__node[data-node-type="container"] *:not(.react-flow__handle),
.react-flow__node[data-type="container"] *:not(.react-flow__handle),
.react-flow__node.container-node,
.react-flow__node.container-node *:not(.react-flow__handle) {
  color: rgb(0 0 0 / 88%) !important;
}

/* Container node specific styling - for try-catch-finally and other containers */

/* Override inline backgroundColor style from getElementColor with !important */

/* Target ReactFlow wrapper that contains container nodes */

/* Use CSS variables for proper theme support in webview */
.react-flow__node-container:has([data-node-type="container"]),
.react-flow__node-container[data-type="container"],
.react-flow__node[data-node-type="container"],
.react-flow__node[data-type="container"],
.vscode-webview .react-flow__node-container:has([data-node-type="container"]),
.vscode-webview .react-flow__node-container[data-type="container"],
.vscode-webview .react-flow__node[data-node-type="container"],
.vscode-webview .react-flow__node[data-type="container"] {
  background-color: var(--vscode-editor-background, #fff) !important;
  border: 1px solid var(--container-border-color, #dedacd) !important;
  border-radius: 5px;
}

.react-flow__node-container:has([data-node-type="container"]).selected,
.react-flow__node-container[data-type="container"].selected,
.react-flow__node[data-node-type="container"].selected,
.react-flow__node[data-type="container"].selected {
  border-color: var(--vscode-focusBorder) !important;
  border-width: 2px;
}

[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"])
  > div,
[data-theme="high-contrast"]
  .react-flow__node-container[data-type="container"]
  > div,
[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"]
  > div[class*="container"],
[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"]
  > div,
[data-theme="high-contrast"]
  .react-flow__node[data-type="container"]
  > div[class*="container"],
[data-theme="high-contrast"] .react-flow__node[data-type="container"] > div,
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"])
  > div,
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container[data-type="container"]
  > div,
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"]
  > div[class*="container"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"]
  > div,
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-type="container"]
  > div[class*="container"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-type="container"]
  > div {
  background-color: var(--vscode-editor-background, #000) !important;
}

/* Target the inner container div directly - override inline styles */

/* Use CSS variables for proper theme support */
.react-flow__node-container:has([data-node-type="container"]) > div,
.react-flow__node-container[data-type="container"] > div,
.react-flow__node[data-node-type="container"] > div[class*="container"],
.react-flow__node[data-node-type="container"] > div,
.react-flow__node[data-type="container"] > div[class*="container"],
.react-flow__node[data-type="container"] > div,
.vscode-webview
  .react-flow__node-container:has([data-node-type="container"])
  > div,
.vscode-webview .react-flow__node-container[data-type="container"] > div,
.vscode-webview
  .react-flow__node[data-node-type="container"]
  > div[class*="container"],
.vscode-webview .react-flow__node[data-node-type="container"] > div,
.vscode-webview
  .react-flow__node[data-type="container"]
  > div[class*="container"],
.vscode-webview .react-flow__node[data-type="container"] > div {
  background-color: var(--vscode-editor-background, #fff) !important;
}

/* High contrast theme adjustments for container nodes */
[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"]),
[data-theme="high-contrast"] .react-flow__node-container[data-type="container"],
[data-theme="high-contrast"] .react-flow__node[data-node-type="container"],
[data-theme="high-contrast"] .react-flow__node[data-type="container"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"]),
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container[data-type="container"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-type="container"] {
  background-color: var(--vscode-editor-background, #000) !important;
  border-color: var(--container-border-color, #fff9e6) !important;
}

/* Dark theme adjustments for container nodes */
[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"]),
[data-theme="dark"] .react-flow__node-container[data-type="container"],
[data-theme="dark"] .react-flow__node[data-node-type="container"],
[data-theme="dark"] .react-flow__node[data-type="container"],
.vscode-webview[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"]),
.vscode-webview[data-theme="dark"]
  .react-flow__node-container[data-type="container"],
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-node-type="container"],
.vscode-webview[data-theme="dark"] .react-flow__node[data-type="container"] {
  background-color: var(--vscode-editor-background, #1f1f1f) !important;
  border-color: var(--container-border-color, #fff9e6) !important;
}

[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"])
  > div,
[data-theme="dark"] .react-flow__node-container[data-type="container"] > div,
[data-theme="dark"]
  .react-flow__node[data-node-type="container"]
  > div[class*="container"],
[data-theme="dark"] .react-flow__node[data-node-type="container"] > div,
[data-theme="dark"]
  .react-flow__node[data-type="container"]
  > div[class*="container"],
[data-theme="dark"] .react-flow__node[data-type="container"] > div,
.vscode-webview[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"])
  > div,
.vscode-webview[data-theme="dark"]
  .react-flow__node-container[data-type="container"]
  > div,
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-node-type="container"]
  > div[class*="container"],
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-node-type="container"]
  > div,
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-type="container"]
  > div[class*="container"],
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-type="container"]
  > div {
  background-color: var(--vscode-editor-background, #1f1f1f) !important;
}

/* Container node header - use CSS variables for proper theme support */
.react-flow__node-container:has([data-node-type="container"]) [class*="header"],
.react-flow__node-container[data-type="container"] [class*="header"],
.react-flow__node[data-node-type="container"] [class*="header"],
.react-flow__node[data-type="container"] [class*="header"],
.react-flow__node.container-node [class*="header"] {
  background: var(--container-header-background, #fff9e6) !important;
  color: rgb(0 0 0 / 88%) !important;
  font-weight: normal !important;
}

/* Container node header - high contrast theme */
[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"])
  [class*="header"],
[data-theme="high-contrast"]
  .react-flow__node-container[data-type="container"]
  [class*="header"],
[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"]
  [class*="header"],
[data-theme="high-contrast"]
  .react-flow__node[data-type="container"]
  [class*="header"],
[data-theme="high-contrast"] .react-flow__node.container-node [class*="header"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container:has([data-node-type="container"])
  [class*="header"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node-container[data-type="container"]
  [class*="header"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-node-type="container"]
  [class*="header"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node[data-type="container"]
  [class*="header"],
.vscode-webview[data-theme="high-contrast"]
  .react-flow__node.container-node
  [class*="header"] {
  background: var(--container-header-background, #fff9e6) !important;
  color: rgb(0 0 0 / 88%) !important;
  font-weight: normal !important;
}

/* Container node header - dark theme */
[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"])
  [class*="header"],
[data-theme="dark"]
  .react-flow__node-container[data-type="container"]
  [class*="header"],
[data-theme="dark"]
  .react-flow__node[data-node-type="container"]
  [class*="header"],
[data-theme="dark"] .react-flow__node[data-type="container"] [class*="header"],
[data-theme="dark"] .react-flow__node.container-node [class*="header"],
.vscode-webview[data-theme="dark"]
  .react-flow__node-container:has([data-node-type="container"])
  [class*="header"],
.vscode-webview[data-theme="dark"]
  .react-flow__node-container[data-type="container"]
  [class*="header"],
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-node-type="container"]
  [class*="header"],
.vscode-webview[data-theme="dark"]
  .react-flow__node[data-type="container"]
  [class*="header"],
.vscode-webview[data-theme="dark"]
  .react-flow__node.container-node
  [class*="header"] {
  background: var(--container-header-background, #fff9e6) !important;
  color: rgb(0 0 0 / 88%) !important;
  font-weight: normal !important;
}

/* Container node badge - light theme: no border to match dark theme size */
[data-theme="light"]
  .react-flow__node-container:has([data-node-type="container"])
  .ant-badge-count,
[data-theme="light"]
  .react-flow__node-container[data-type="container"]
  .ant-badge-count,
[data-theme="light"]
  .react-flow__node[data-node-type="container"]
  .ant-badge-count,
[data-theme="light"] .react-flow__node[data-type="container"] .ant-badge-count {
  border: none !important;
}

/* Edge styling */
.react-flow__edge {
  stroke: var(--vscode-foreground);
  stroke-width: 2px;
}

.react-flow__edge.selected {
  stroke: var(--vscode-focusBorder);
  stroke-width: 3px;
}

.react-flow__edge-path {
  stroke: var(--vscode-foreground);
}

[data-theme="dark"] .react-flow__edge-path {
  stroke: rgb(255 255 255 / 40%);
}

.react-flow__edge.selected .react-flow__edge-path {
  stroke: var(--vscode-focusBorder);
}

/* Dark theme - more visible edges */
[data-theme="dark"] .react-flow__edge {
  stroke: rgb(255 255 255 / 40%);
}

[data-theme="dark"] .react-flow__edge.selected {
  stroke: var(--vscode-focusBorder);
}

[data-theme="dark"] .react-flow__edge.selected .react-flow__edge-path {
  stroke: var(--vscode-focusBorder);
}

/* Connection line */
.react-flow__connectionline {
  stroke: var(--vscode-focusBorder);
  stroke-width: 2px;
  stroke-dasharray: 5;
}

/* Handle styling */
.react-flow__handle {
  background-color: var(--vscode-button-background);
  border: 2px solid var(--vscode-editor-background);
  width: 8px;
  height: 8px;
}

.react-flow__handle:hover {
  background-color: var(--vscode-button-hoverBackground);
}

.react-flow__handle.valid {
  background-color: var(--vscode-terminal-ansiGreen);
}

.react-flow__handle.connecting {
  background-color: var(--vscode-focusBorder);
}

/* Custom node styles - flat design */
.trigger-node {
  background-color: var(--vscode-panel-background);
  border: 1px solid var(--vscode-border);
  border-radius: 4px;
  color: rgb(0 0 0 / 88%);
  padding: 10px;
}

.dndnode {
  border: 1px solid var(--vscode-border);
  border-radius: 4px;
  cursor: grab;
  background-color: var(--vscode-panel-background);
  color: var(--vscode-foreground);
  padding: 8px;
}

.dndnode:hover {
  border-color: var(--vscode-focusBorder);
  background-color: var(--vscode-sideBar-background);
}

/* Background patterns - dots with theme support */
.react-flow__background {
  background-color: var(--vscode-panel-background) !important;
}

/* ReactFlow background pattern */
.react-flow__background .react-flow__background-pattern {
  fill: var(--vscode-foreground) !important;
}

/* MiniMap theming - only colors, standard ReactFlow style */
.react-flow__minimap {
  background-color: var(--vscode-editor-background) !important;
  border: 1px solid var(--vscode-foreground) !important;
}

[data-theme="dark"] .react-flow__minimap {
  background-color: #141414 !important;
}

[data-theme="light"] .react-flow__minimap {
  background-color: #fff !important;
}

.react-flow__minimap-mask {
  fill: var(--vscode-panel-background) !important;
}

/* Controls theming - only colors, standard ReactFlow style */
.react-flow__controls {
  background-color: var(--vscode-panel-background);
}

.react-flow__controls-button {
  background-color: var(--vscode-panel-background);
  color: var(--vscode-foreground);
  border-bottom-color: var(--vscode-border);
}

.react-flow__controls-button:hover {
  background-color: var(--vscode-sideBar-background);
}

/* Panel theming - only colors, standard ReactFlow style */
.react-flow__panel {
  background-color: var(--vscode-panel-background);
  border-color: var(--vscode-border);
  color: var(--vscode-foreground);
}

[class~="react-flow__node"].highlight [class~="react-flow__handle"] {
  box-shadow: none !important;
  border: 2px solid var(--vscode-focusBorder) !important;
}

/* Tooltips - flat design */
.trigger-node-input .tooltiptext {
  visibility: hidden;
  background-color: var(--vscode-panel-background);
  color: var(--vscode-foreground);
  border: 1px solid var(--vscode-border);
  border-radius: 4px;
  padding: 5px;
  position: absolute;
  z-index: 1000;
  box-shadow: none;
}

.trigger-node-input:hover .tooltiptext {
  visibility: visible;
}
